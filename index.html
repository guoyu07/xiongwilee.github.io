<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Wilee</title>

  <meta name="author" content="xiongwilee">
  
  <meta name="description" content="blog">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="Wilee"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Wilee" type="application/atom+xml">
  <link rel="stylesheet" href="/bootstrap/bootstrap.min.css" type="text/css">
<link rel="stylesheet" href="/fontawesome/css/font-awesome.css" type="text/css">
<link rel="stylesheet" href="/css/style.css" type="text/css">
  <script src="//apps.bdimg.com/libs/jquery/2.1.1/jquery.min.js"></script>
  <!--[if lt IE 9]><script src="/js/html5.js"></script><![endif]-->


<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F3460af47268846ca3d274b44b6aeb8ce' type='text/javascript'%3E%3C/script%3E"));
</script>

</head>

<body>

  <header id="header" class='normal_mode'>
    <div id="top">
  <nav id="nav">
    <ul class='main-nav-ul'><!-- 
      
        <li><a href="/archives">Archives</a></li>
      
        <li><a href="/about">About</a></li>
       -->
      <li><a href="/"><i class="fa fa-home"></i></a></li>
    </ul>
  </nav>
  <form id="search" class="search" action="http://www.baidu.com/s" method="get">
  	<input type="text" class="search_text" placeholder="search" autocomplete="off">
  	<input type="hidden" class="search_hidden" name="wd">
  	<button type="submit" class="search_btn fa fa-search"></button>
  </form>
</div>
<script>
(function($){
  $('#search .search_btn').click(function(){
    var formEle = $('#search'),
      textEle = $("#search .search_text"),
      hiddenEle = $("#search .search_hidden");
    hiddenEle.val(textEle.val()+' site:wilee.me');
    formEle.submit()
  })
})(jQuery)
</script>
  </header>


  <div id="content" class="container" data-0="box-shadow:0px 0px 100px rgba(0,0,0,.5)" data-800="box-shadow:0px 0px 1000px rgba(0,0,0,1)">

    <div id="cover">
	<div id="profile" alt="/image/bg_1.jpg">
		<div href="/" id="title" class="title">
			<a class="title_link">Wilee<i>ME</i></a>
		</div>

		
			<div id="subtitle" class="subtitle">
				<span class="subtitle_content">知而获智，智达高远</span>
			</div>
		
		<div id="socials" class="socials">
  <ul class="my-socials">
    
    <li>
    	<a href="https://github.com/xiongwilee" class="github" target="_blank">
    		<i class="fa fa-github"></i>
    	</a>
    </li>
    
    <li>
    	<a href="http://weibo.com/wileexiong" class="weibo" target="_blank">
    		<i class="fa fa-weibo"></i>
    	</a>
    </li>
    
    
    <li>
     	<a href="mailto:wilee@outlook.com" class="email" target="_blank" title="Email Me">
    		<i class="fa fa-envelope"></i>
    	</a>
    </li>
    
  </ul>
</div>
	</div>
	<!--<div id="plane_wrapper" class="plane_wrapper">
		<img class="plane" src="/image/plane.png" data-0="-webkit-transform:translateX(-200px) translateY(0px) translateZ(0px)" data-1000="-webkit-transform:translateX(1000px) translateY(-100px) translateZ(600px)" />
	</div>-->
</div>


  <article class="post">
  <div class="post-content">
    <header>
      
       

  
    <h1 class="title">
      <a href="/2016/03/24/fe-tools/" target="_blank"> fe-tools</a>
    </h1>
  

<div class="collection">
  <time datetime="2016-03-24T12:02:03.000Z"><i class="fa fa-clock-o"></i><span> 2016-03-24 08:02</span></time>
  
  
  
  <div class="tags">
  	<i class="fa fa-tag"></i>
    <a href="/tags/tools/">tools</a>
  </div>

</div>
<div class="clear"></div>
      
    </header>
    
      <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"><i class="fa fa-chevron-left"></i></div>
    <div class="next"><i class="fa fa-chevron-right"></i></div>
  </div>
</div>
    
    <div class="entry">
      
        <h1 id="前端开发工具"><a href="#前端开发工具" class="headerlink" title="前端开发工具"></a>前端开发工具</h1><h3 id="编辑器及插件"><a href="#编辑器及插件" class="headerlink" title="编辑器及插件"></a>编辑器及插件</h3><table>
<thead>
<tr>
<th style="text-align:left">名称</th>
<th style="text-align:left">推荐理由</th>
<th style="text-align:left">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">ATOM</td>
<td style="text-align:left">/</td>
<td style="text-align:left">编辑器本身</td>
</tr>
<tr>
<td style="text-align:left">atom-beautify</td>
<td style="text-align:left">编辑器代码美化</td>
<td style="text-align:left">/</td>
</tr>
<tr>
<td style="text-align:left">atomic-chrome</td>
<td style="text-align:left">使用atom编辑页面中的输入框内容</td>
<td style="text-align:left">/</td>
</tr>
<tr>
<td style="text-align:left">atomic-emacs</td>
<td style="text-align:left">emacs快捷键绑定</td>
<td style="text-align:left">Ctrl+x 3分屏的赶脚爽多了</td>
</tr>
<tr>
<td style="text-align:left">autocomplete</td>
<td style="text-align:left">自动完成</td>
<td style="text-align:left">必备</td>
</tr>
<tr>
<td style="text-align:left">autoprefixer</td>
<td style="text-align:left">自动前缀</td>
<td style="text-align:left">css3必备</td>
</tr>
<tr>
<td style="text-align:left">colorpicker</td>
<td style="text-align:left">颜色拾取</td>
<td style="text-align:left">在编辑器中使用频率不高</td>
</tr>
<tr>
<td style="text-align:left">codeif</td>
<td style="text-align:left">命名神器</td>
<td style="text-align:left">听奏写的变量命名服务</td>
</tr>
<tr>
<td style="text-align:left">emmet</td>
<td style="text-align:left">前端开发神器</td>
<td style="text-align:left"><a href="http://docs.emmet.io/cheat-sheet/" target="_blank" rel="external">http://docs.emmet.io/cheat-sheet/</a></td>
</tr>
<tr>
<td style="text-align:left">terminal-plus</td>
<td style="text-align:left">编辑器集成终端</td>
<td style="text-align:left">打造ide的前奏</td>
</tr>
<tr>
<td style="text-align:left">file-icons</td>
<td style="text-align:left">文件图标显示</td>
<td style="text-align:left">不装逼,很实用</td>
</tr>
</tbody>
</table>
<h3 id="OSX工具集"><a href="#OSX工具集" class="headerlink" title="OSX工具集"></a>OSX工具集</h3><table>
<thead>
<tr>
<th style="text-align:left">名称</th>
<th style="text-align:left">推荐理由</th>
<th style="text-align:left">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Alfred</td>
<td style="text-align:left">快启神器</td>
<td style="text-align:left">不多说了</td>
</tr>
<tr>
<td style="text-align:left">Tmux</td>
<td style="text-align:left">终端分屏</td>
<td style="text-align:left">神器属性爆表</td>
</tr>
<tr>
<td style="text-align:left">oh-my-zsh</td>
<td style="text-align:left">zsh增强版</td>
<td style="text-align:left">神器属性爆表</td>
</tr>
<tr>
<td style="text-align:left">Gitbook Editor</td>
<td style="text-align:left">写书用</td>
<td style="text-align:left">/</td>
</tr>
<tr>
<td style="text-align:left">Spectacle</td>
<td style="text-align:left">窗口按指定位置摆放</td>
<td style="text-align:left">/</td>
</tr>
<tr>
<td style="text-align:left">微信Web开发者工具</td>
<td style="text-align:left">微信开发必备</td>
<td style="text-align:left">/</td>
</tr>
<tr>
<td style="text-align:left">Dash</td>
<td style="text-align:left">手册仓库</td>
<td style="text-align:left">神器属性爆表</td>
</tr>
<tr>
<td style="text-align:left">AssitorPS</td>
<td style="text-align:left">切图辅助</td>
<td style="text-align:left">神器属性爆表</td>
</tr>
<tr>
<td style="text-align:left">Macdown</td>
<td style="text-align:left">Markdown编写</td>
<td style="text-align:left">体验佳</td>
</tr>
</tbody>
</table>
<h3 id="Chrome插件"><a href="#Chrome插件" class="headerlink" title="Chrome插件"></a>Chrome插件</h3><table>
<thead>
<tr>
<th style="text-align:left">名称</th>
<th style="text-align:left">推荐理由</th>
<th style="text-align:left">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">postman</td>
<td style="text-align:left">必备神器</td>
<td style="text-align:left">/</td>
</tr>
<tr>
<td style="text-align:left">Avatars for Github</td>
<td style="text-align:left">Github的动态上显示头像</td>
<td style="text-align:left">/</td>
</tr>
<tr>
<td style="text-align:left">DevTools Author</td>
<td style="text-align:left">在chrome的Sources,console等面板美化代码显示</td>
<td style="text-align:left">/</td>
</tr>
<tr>
<td style="text-align:left">Google绘图</td>
<td style="text-align:left">画UML咯</td>
<td style="text-align:left">/</td>
</tr>
<tr>
<td style="text-align:left">Isometric Contributions</td>
<td style="text-align:left">以3d柱状图显示Github Contributions</td>
<td style="text-align:left">/</td>
</tr>
<tr>
<td style="text-align:left">JSON-handle</td>
<td style="text-align:left">json编辑神器</td>
<td style="text-align:left">/</td>
</tr>
<tr>
<td style="text-align:left">JSONView</td>
<td style="text-align:left">json查看神器</td>
<td style="text-align:left">/</td>
</tr>
<tr>
<td style="text-align:left">Lastpass</td>
<td style="text-align:left">密码管理</td>
<td style="text-align:left">/</td>
</tr>
<tr>
<td style="text-align:left">Momentum</td>
<td style="text-align:left">壁纸,TODO</td>
<td style="text-align:left">/</td>
</tr>
<tr>
<td style="text-align:left">Octotree</td>
<td style="text-align:left">在Github左侧显示项目的Tree</td>
<td style="text-align:left">阅读和学习开源项目的神器</td>
</tr>
<tr>
<td style="text-align:left">OneTab</td>
<td style="text-align:left">不多说了，节省资源神器</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">React Developer Tools</td>
<td style="text-align:left">React开发必备</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">Vimium</td>
<td style="text-align:left">vim快捷键操作浏览器</td>
<td style="text-align:left">神器属性爆表</td>
</tr>
<tr>
<td style="text-align:left">WEB前端助手(FeHelper)</td>
<td style="text-align:left">常用工具箱</td>
<td style="text-align:left">国产优秀插件</td>
</tr>
<tr>
<td style="text-align:left">划词翻译</td>
<td style="text-align:left">很方便</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">稀土掘金</td>
<td style="text-align:left">掘金社区Co-Editor必备</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">Xmarks</td>
<td style="text-align:left">浏览器收藏夹同步</td>
<td style="text-align:left">必备良品</td>
</tr>
</tbody>
</table>
<h3 id="CLI增强"><a href="#CLI增强" class="headerlink" title="CLI增强"></a>CLI增强</h3><table>
<thead>
<tr>
<th style="text-align:left">名称</th>
<th style="text-align:left">推荐理由</th>
<th style="text-align:left">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">caniuse-cmd</td>
<td style="text-align:left">caniuse命令行版</td>
<td style="text-align:left">实用</td>
</tr>
</tbody>
</table>

      
    </div>
    <footer>
      
        <div class="alignleft">
            <a href="/2016/03/24/fe-tools/#more" class="more-link"><i class="fa fa-chevron-right"></i>更多</a>
        </div>
        
        
          <div class="alignright"> 
            <a href="http://wilee.me/2016/03/24/fe-tools/#comment" class="comment-link">
              <i class="fa fa-comments"></i><span class="ds-thread-count" data-thread-key="/2016/03/24/fe-tools/">&nbsp;
              </span>
            </a>
          </div>
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  <div class="post-content">
    <header>
      
       

  
    <h1 class="title">
      <a href="/2016/03/24/office-node/" target="_blank"> 在开发机中玩转Node.js</a>
    </h1>
  

<div class="collection">
  <time datetime="2016-03-24T11:21:00.000Z"><i class="fa fa-clock-o"></i><span> 2016-03-24 07:21</span></time>
  
  
  <div class="categories">
  	<i class="fa fa-folder-open"></i>
    <a href="/categories/技术/">技术</a>
  </div>

  
  
  <div class="tags">
  	<i class="fa fa-tag"></i>
    <a href="/tags/Node-js/">Node.js</a>
  </div>

</div>
<div class="clear"></div>
      
    </header>
    
      <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"><i class="fa fa-chevron-left"></i></div>
    <div class="next"><i class="fa fa-chevron-right"></i></div>
  </div>
</div>
    
    <div class="entry">
      
        <h1 id="在开发机中玩转Node-js"><a href="#在开发机中玩转Node-js" class="headerlink" title="在开发机中玩转Node.js"></a>在开发机中玩转Node.js</h1><h2 id="一、查看Node-js版本"><a href="#一、查看Node-js版本" class="headerlink" title="一、查看Node.js版本"></a>一、查看Node.js版本</h2><p>开发机已经预装了Node.js，你可以直接在命令行里输入<code>node -v</code>查看Node.js版本。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ node -v</span><br></pre></td></tr></table></figure>
<h2 id="二、命令行中执行node脚本"><a href="#二、命令行中执行node脚本" class="headerlink" title="二、命令行中执行node脚本"></a>二、命令行中执行node脚本</h2><p>也可以输入<code>node</code>，然后在命令行里执行Node.js脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ node&#10;&#62; console.log(&#39;hello world!&#39;) # &#36755;&#20837;&#23436;&#20043;&#21518;&#22238;&#36710;</span><br></pre></td></tr></table></figure>
<p><img src="http://wilee.me/demo/photo/node.gif" alt=""></p>
<h2 id="三、执行Node-js文件"><a href="#三、执行Node-js文件" class="headerlink" title="三、执行Node.js文件"></a>三、执行Node.js文件</h2><p>你还可以在任意目录创建一个<code>helloworld.js</code>的文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">console.log(&#39;hello world!&#39;);</span><br></pre></td></tr></table></figure>
<p>然后用<code>node</code>命令执行它：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ node helloworld.js</span><br></pre></td></tr></table></figure>
<p><img src="http://wilee.me/demo/photo/node_1.gif" alt=""></p>
<h2 id="四、写一个简单的node-server-服务器"><a href="#四、写一个简单的node-server-服务器" class="headerlink" title="四、写一个简单的node server(服务器)"></a>四、写一个简单的node server(服务器)</h2><p>首先，创建一个<code>server.js</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// &#31471;&#21475;&#21495;&#33258;&#24049;&#20889;&#65292;&#19981;&#35201;&#19982;&#29616;&#26377;&#30340;&#31471;&#21475;&#21495;&#20914;&#31361;&#23601;&#34892;&#10;var port = &#39;8000&#39;;&#10;&#10;// &#21019;&#24314;server,&#24182;&#36755;&#20986;&#39;hello world!&#39;&#10;var server = require(&#39;http&#39;).createServer(function(req, res)&#123;&#10;  res.end(&#39;hello world!&#39;);&#10;&#125;);&#10;&#10;// &#30417;&#21548;&#21018;&#21018;&#23450;&#20041;&#30340;&#31471;&#21475;&#65292;&#21551;&#21160;server&#10;server.listen(port);&#10;&#10;console.log(&#39;server started at http://192.168.1.10:&#39;+port);</span><br></pre></td></tr></table></figure>
<p>然后，执行<code>node server.js</code>。</p>
<p>看到输出<code>server started at http://192.168.1.10:8000</code> 说明服务已经启动。</p>
<p>最后，打开浏览器访问：<a href="http://192.168.1.10:8000" target="_blank" rel="external">http://192.168.1.10:8000</a>  , 就可以看到’hello world!’了！</p>
<p><img src="http://wilee.me/demo/photo/node_2.gif" alt=""></p>

      
    </div>
    <footer>
      
        <div class="alignleft">
            <a href="/2016/03/24/office-node/#more" class="more-link"><i class="fa fa-chevron-right"></i>更多</a>
        </div>
        
        
          <div class="alignright"> 
            <a href="http://wilee.me/2016/03/24/office-node/#comment" class="comment-link">
              <i class="fa fa-comments"></i><span class="ds-thread-count" data-thread-key="/2016/03/24/office-node/">&nbsp;
              </span>
            </a>
          </div>
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  <div class="post-content">
    <header>
      
       

  
    <h1 class="title">
      <a href="/2016/03/03/koa-grace/" target="_blank"><i class="fa fa-file-powerpoint-o"></i> koa-grace</a>
    </h1>
  

<div class="collection">
  <time datetime="2016-03-03T02:55:00.000Z"><i class="fa fa-clock-o"></i><span> 2016-03-03 10:55</span></time>
  
  
</div>
<div class="clear"></div>
      
    </header>
    
      <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"><i class="fa fa-chevron-left"></i></div>
    <div class="next"><i class="fa fa-chevron-right"></i></div>
  </div>
</div>
    
    <div class="entry">
      
        <p>koa-grace诞生记：19天打造nodejs多应用MVC框架及基于该框架的CMS博客系统</p>
      
    </div>
    <footer>
      
        <div class="alignleft">
            <a href="/2016/03/03/koa-grace/#more" class="more-link"><i class="fa fa-chevron-right"></i>更多</a>
        </div>
        
        
          <div class="alignright"> 
            <a href="http://wilee.me/2016/03/03/koa-grace/#comment" class="comment-link">
              <i class="fa fa-comments"></i><span class="ds-thread-count" data-thread-key="/2016/03/03/koa-grace/">&nbsp;
              </span>
            </a>
          </div>
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  <div class="post-content">
    <header>
      
       

  
    <h1 class="title">
      <a href="/2016/02/22/koa-grace-document/" target="_blank"> koa-grace中文文档</a>
    </h1>
  

<div class="collection">
  <time datetime="2016-02-22T06:52:28.000Z"><i class="fa fa-clock-o"></i><span> 2016-02-22 02:52</span></time>
  
  
  
  <div class="tags">
  	<i class="fa fa-tag"></i>
    <a href="/tags/fe-nodejs/">fe, nodejs</a>
  </div>

</div>
<div class="clear"></div>
      
    </header>
    
      <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"><i class="fa fa-chevron-left"></i></div>
    <div class="next"><i class="fa fa-chevron-right"></i></div>
  </div>
</div>
    
    <div class="entry">
      
        <h1 id="1-koa-grace简介"><a href="#1-koa-grace简介" class="headerlink" title="1. koa-grace简介"></a>1. koa-grace简介</h1><p>koa-grace是基于<a href="https://github.com/koajs/koa" target="_blank" rel="external">koa 1.x</a>的新一代Nodejs多站点MVC框架。项目地址：<a href="https://github.com/xiongwilee/koa-grace" target="_blank" rel="external">https://github.com/xiongwilee/koa-grace</a></p>
<h2 id="1-1-特征"><a href="#1-1-特征" class="headerlink" title="1.1 特征"></a>1.1 特征</h2><p>为什么koa-grace是新一代Nodejs MVC框架：</p>
<ul>
<li>一个node服务，多个站点应用；</li>
<li>yield 异步语法支持，忘掉回调噩梦；</li>
<li>继承koa中间件，扩展性更强；</li>
<li>支持<code>路径即路由</code>，更优雅的路由方式；</li>
<li>RESTful数据代理支持，前后端完全解耦；<br>……</li>
</ul>
<h2 id="1-2-目录结构"><a href="#1-2-目录结构" class="headerlink" title="1.2 目录结构"></a>1.2 目录结构</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">├── app						<span class="comment">// 站点总目录</span></span><br><span class="line">│   ├── blog 					<span class="comment">// 站点：blog目录</span></span><br><span class="line">│   │   ├── controller 				<span class="comment">// 站点：blog的路由（控制器）目录</span></span><br><span class="line">│   │   ├── model 					<span class="comment">// 站点：blog的模型目录，包括公共控制器、mongo等</span></span><br><span class="line">│   │   ├── static 					<span class="comment">// 站点：blog的静态文件目录</span></span><br><span class="line">│   │   └── views 					<span class="comment">// 站点：blog的html模板目录</span></span><br><span class="line">│   ├── reactjs-boilerplate 	<span class="comment">// 站点：reactjs-boilerplate目录</span></span><br><span class="line">│   └── shop 					<span class="comment">// 站点：shop目录</span></span><br><span class="line">├── bin						<span class="comment">// server启动器目录</span></span><br><span class="line">│   ├── koa-grace 				<span class="comment">// <span class="doctag">TODO:</span>命令行工具</span></span><br><span class="line">│   └── server.js  				<span class="comment">// server启动器</span></span><br><span class="line">├── config 					<span class="comment">// 配置文件目录</span></span><br><span class="line">│   └── main.js					<span class="comment">// 主配置文件</span></span><br><span class="line">├── package.json</span><br><span class="line">└── src						<span class="comment">// 核心文件</span></span><br><span class="line">    └── app.js					<span class="comment">// 主文件</span></span><br></pre></td></tr></table></figure>
<h1 id="2-快速开始"><a href="#2-快速开始" class="headerlink" title="2. 快速开始"></a>2. 快速开始</h1><p>在开始使用koa-grace之前请确保您已经安装并运行了下面的工具:</p>
<ul>
<li>Nodejs (v4+)</li>
<li>MongoDB (DEMO 演示使用，正式环境可以配置不用)</li>
</ul>
<h3 id="2-1-安装"><a href="#2-1-安装" class="headerlink" title="2.1 安装"></a>2.1 安装</h3><pre><code>$ git clone https://github.com/xiongwilee/koa-grace.git 
$ cd koa-grace &amp;&amp; npm install
</code></pre><h3 id="2-2-配置"><a href="#2-2-配置" class="headerlink" title="2.2 配置"></a>2.2 配置</h3><p>在koa-grace目录下，打开配置文件:</p>
<pre><code>$ vi config/main.js
</code></pre><p>修改配置项：<code>config.mongo.blog</code> 为您的本地mongoDB的路径:</p>
<pre><code>// mongo configuration
mongo: {
  &apos;blog&apos;: &apos;mongodb://localhost:27017/blog&apos;
}
</code></pre><p>**更多关于配置项的文档可以看下面的使用文档。</p>
<h3 id="2-3-运行"><a href="#2-3-运行" class="headerlink" title="2.3 运行"></a>2.3 运行</h3><p>在koa-grace目录下执行，可能需要root权限：    </p>
<pre><code>$ npm run dev
</code></pre><p>然后访问  <a href="http://127.0.0.1:3000/home" target="_blank" rel="external">http://127.0.0.1:3000</a>  ，就可以看到koa-grace其中的一个案例站点了！</p>
<p>您也可以访问koa-grace的一个线上应用： <a href="http://mlsfe.biz" target="_blank" rel="external">http://mlsfe.biz</a> 。</p>
<h1 id="3-详细使用文档"><a href="#3-详细使用文档" class="headerlink" title="3. 详细使用文档"></a>3. 详细使用文档</h1><p>虽说koa-grace是一个完整的MVC框架 ， 但其本质是基于一种多站点解决方案的koa中间件的集合。其核心中间件包括但不仅限于： <a href="https://github.com/alexmingoia/koa-router" target="_blank" rel="external">koa-router</a> , <a href="https://github.com/queckezz/koa-views" target="_blank" rel="external">koa-views</a> , <a href="https://github.com/koajs/mount" target="_blank" rel="external">koa-mount</a> , <a href="https://github.com/koajs/static/" target="_blank" rel="external">koa-static</a> , <a href="https://github.com/xiongwilee/koa-grace-vhost" target="_blank" rel="external">koa-grace-vhost</a> , <a href="https://github.com/xiongwilee/koa-grace-router" target="_blank" rel="external">koa-grace-router</a> , <a href="https://github.com/xiongwilee/koa-grace-proxy" target="_blank" rel="external">koa-grace-proxy</a> , <a href="https://github.com/xiongwilee/koa-grace-model" target="_blank" rel="external">koa-grace-model</a> , <a href="https://github.com/xiongwilee/koa-grace-mongo" target="_blank" rel="external">koa-grace-mongo</a> , …</p>
<h2 id="3-1-多站点配置-Vhost"><a href="#3-1-多站点配置-Vhost" class="headerlink" title="3.1 多站点配置 - Vhost"></a>3.1 多站点配置 - Vhost</h2><p>koa-grace是基于 <a href="https://github.com/xiongwilee/koa-grace-vhost" target="_blank" rel="external">koa-grace-vhost</a> 进行vhost管理，基本原理是：</p>
<blockquote>
<p>一个域名对应一个应用，一个应用对应一个目录</p>
</blockquote>
<p>如此一来，配置多站点就很简单了，在配置文件<code>config/main.js</code>中：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vhost配置</span></span><br><span class="line">vhost: &#123;</span><br><span class="line">  <span class="string">'test.mlsfe.biz'</span>:<span class="string">'blog'</span>,</span><br><span class="line">  <span class="string">'127.0.0.1'</span>:<span class="string">'blog'</span>,</span><br><span class="line">  <span class="string">'localhost'</span>:<span class="string">'shop'</span>,</span><br><span class="line">  <span class="string">'0.0.0.0'</span>:<span class="string">'reactjs-boilerplate'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中，vhost配置中<code>127.0.0.1</code>是URI的<code>hostname</code>, <code>blog</code>是站点总目录app下的一个目录<code>app/blog</code>。如果当前请求URI为：<a href="http://127.0.0.1/home" target="_blank" rel="external">http://127.0.0.1/home</a> 则koa-grace会自动访问<code>app/blog</code>目录里的路由、模型、静态文件。</p>
<p>需要说明的是，<strong>多站点配置仅以URI的hostname为主键</strong> ；也就是说，访问带端口号的<a href="http://127.0.0.1:3000/home" target="_blank" rel="external">http://127.0.0.1:3000/home</a> 也会定位到app/blog目录。</p>
<h2 id="3-2-路由及控制器-Router-amp-Controller"><a href="#3-2-路由及控制器-Router-amp-Controller" class="headerlink" title="3.2 路由及控制器 - Router&amp;Controller"></a>3.2 路由及控制器 - Router&amp;Controller</h2><p>很好，如果你配置好了一个vhost为<code>&#39;127.0.0.1&#39;:&#39;blog&#39;</code> , koa-grace就会自动生成一个vhost到<code>app/blog</code>目录了！接下来，进入<code>app/blog/controller</code>目录进行路由配置。</p>
<p>koa-grace基于 <a href="https://github.com/xiongwilee/koa-grace-router" target="_blank" rel="external">koa-grace-router</a> 进行路由管理的，koa-grace-router又是依赖于：<a href="https://github.com/alexmingoia/koa-router" target="_blank" rel="external">koa-router</a> 。</p>
<h3 id="3-2-1-文件路径即路由"><a href="#3-2-1-文件路径即路由" class="headerlink" title="3.2.1 文件路径即路由"></a>3.2.1 文件路径即路由</h3><p>以<code>blog</code>站点为例，<code>koa-grace-router</code>会找到 <code>app/blog/*</code> 目录下的所有<code>.js</code>后缀的文件，并以文件路径生成路由。我们再看一下案例中<code>blog</code>的路由文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#9500;&#9472;&#9472; api&#10;&#9474;   &#9492;&#9472;&#9472; post.js&#10;&#9500;&#9472;&#9472; dashboard&#10;&#9474;   &#9500;&#9472;&#9472; post.js&#10;&#9474;   &#9500;&#9472;&#9472; site.js&#10;&#9474;   &#9500;&#9472;&#9472; user.js&#10;&#9474;   &#9492;&#9472;&#9472; userAuthor.js&#10;&#9500;&#9472;&#9472; error.js&#10;&#9500;&#9472;&#9472; home.js&#10;&#9500;&#9472;&#9472; post.js&#10;&#9492;&#9472;&#9472; user.js</span><br></pre></td></tr></table></figure>
<p>如果当前请求URI为：<a href="http://127.0.0.1/dashboard/post/*" target="_blank" rel="external">http://127.0.0.1/dashboard/post/*</a> 则路由将自动落在<code>dashboard/post.js</code>文件中。</p>
<p>那么，如果请求路径如果是<a href="http://127.0.0.1/dashboard/post/list" target="_blank" rel="external">http://127.0.0.1/dashboard/post/list</a> ，这个<code>dashboard/post.js</code>文件是如何控制的呢？</p>
<h3 id="3-2-2-路由文件详细说明"><a href="#3-2-2-路由文件详细说明" class="headerlink" title="3.2.2 路由文件详细说明"></a>3.2.2 路由文件详细说明</h3><p>打开<code>app/blog/controller/dashboard/post.js</code>文件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*...*/</span></span><br><span class="line">exports.list = <span class="function"><span class="keyword">function</span>* (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 绑定默认控制器</span></span><br><span class="line">  <span class="keyword">yield</span> <span class="keyword">this</span>.bindDefault();</span><br><span class="line">  <span class="comment">// 独立权限控制</span></span><br><span class="line">  <span class="keyword">if</span> (!userAuthor.checkAuth(<span class="keyword">this</span>, <span class="keyword">this</span>.userInfo)) &#123;<span class="keyword">return</span>&#125;;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 获取请求query参数</span></span><br><span class="line">  <span class="keyword">let</span> pageNum = <span class="keyword">this</span>.query.page;</span><br><span class="line">  <span class="comment">// 获取数据</span></span><br><span class="line">  <span class="keyword">let</span> PostModel = <span class="keyword">this</span>.mongo(<span class="string">'Post'</span>);</span><br><span class="line">  <span class="keyword">let</span> posts = <span class="keyword">yield</span> PostModel.page(pageNum,<span class="number">20</span>);</span><br><span class="line">  <span class="keyword">let</span> page = <span class="keyword">yield</span> PostModel.count(pageNum,<span class="number">20</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 渲染模板</span></span><br><span class="line">  <span class="keyword">yield</span> <span class="keyword">this</span>.render(<span class="string">'dashboard/post_list'</span>,&#123;</span><br><span class="line">    breads : [<span class="string">'文章管理'</span>,<span class="string">'文章列表'</span>],</span><br><span class="line">    posts:posts,</span><br><span class="line">    page:page,</span><br><span class="line">    userInfo: <span class="keyword">this</span>.userInfo,</span><br><span class="line">    siteInfo: <span class="keyword">this</span>.siteInfo</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line">exports.list.__method__ = <span class="string">'get'</span>;</span><br><span class="line">exports.list.__regular__ = <span class="literal">null</span>;</span><br><span class="line"><span class="comment">/*...*/</span></span><br></pre></td></tr></table></figure>
<p>对，就是你猜的那样：koa-grace-router是通过post.js的module.exports进行下一步的路由控制。</p>
<p>另外，需要说明以下几点：</p>
<ul>
<li>如果需要配置dashboard/post/list请求为<code>POST</code>方法，则post.js中声明 <code>exports.list.__method__ = &#39;post&#39;</code>即可（不声明默认为get请求），更多方法类型请参看：<a href="https://github.com/alexmingoia/koa-router#routergetputpostpatchdelete--router" target="_blank" rel="external">koa-router#routergetputpostpatchdelete–router</a>;</li>
<li>如果要进一步配置dashboard/post/list/id路由，则在post.js中声明<code>exports.list.__regular__ = &#39;/:id&#39;;</code>即可，更多相关配置请参看：<a href="https://github.com/alexmingoia/koa-router#named-routes" target="_blank" rel="external">koa-router#named-routes</a></li>
<li>如果当前文件路由就是一个独立的控制器，则<code>module.exports</code>返回一个yield方法即可，可以参考案例<code>blog</code>中的<code>controll/home.js</code></li>
<li>如果当前文件仅仅是一个依赖，仅仅被其他文件引用；则在文件中配置<code>exports.__controller__ = false</code>，该文件就不会生成路由了</li>
</ul>
<p>当然，如果一个路由文件中的控制器方法都是post方法，您可以在控制器文件最底部加入：<code>module.exports.__method__ = &#39;post&#39;</code>即可。<code>__regular__</code>的配置同理。</p>
<h3 id="3-2-3-控制器"><a href="#3-2-3-控制器" class="headerlink" title="3.2.3 控制器"></a>3.2.3 控制器</h3><p>刚刚我们看到了post.js中的exports.list方法，事实上它就是一个控制器（controller）了。</p>
<p>您可以新建一个<code>app/blog/controller/hello.js</code>文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">exports.koagrace = funtion* ()&#123;</span><br><span class="line">	<span class="keyword">this</span>.body = <span class="string">'hello koa-grace！'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>访问 <a href="http://127.0.0.1/hello/koagrace" target="_blank" rel="external">http://127.0.0.1/hello/koagrace</a> ，就可以看到“hello koa-grace！”输出。它是典型的一个基于上下文（context）的yield方法。几个关键方法/参数使用如下：</p>
<table>
<thead>
<tr>
<th>context属性</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>this.query</code></td>
<td><code>object</code></td>
<td>get参数</td>
</tr>
<tr>
<td><code>this.request.body</code></td>
<td><code>object</code></td>
<td>post参数，由于koa-grace默认引入了<a href="https://github.com/koajs/body-parser" target="_blank" rel="external">koa-bodypaser</a>，您可以直接在this.request.body中获取到post参数</td>
</tr>
<tr>
<td><code>this.bindDefault</code></td>
<td><code>function</code></td>
<td>公共控制器，相当于<code>require(&#39;app/blog/model/defaultCtrl.js&#39;)</code></td>
</tr>
<tr>
<td><code>this.render</code></td>
<td><code>function</code></td>
<td>模板引擎渲染方法，请参看：3.5 模板引擎- Template engine</td>
</tr>
<tr>
<td><code>this.mongo</code></td>
<td><code>function</code></td>
<td>数据库操作方法，请参看：3.3 数据库 - Database</td>
</tr>
<tr>
<td><code>this.mongoMap</code></td>
<td><code>function</code></td>
<td>并行数据库多操作方法，请参看：3.3 数据库 - Database</td>
</tr>
<tr>
<td><code>this.proxy</code></td>
<td><code>function</code></td>
<td>RESTful数据请求方法，请参看：3.4.1 数据代理</td>
</tr>
<tr>
<td><code>this.download</code></td>
<td><code>function</code></td>
<td>文件请求代理方法，请参看：3.4.2 请求代理</td>
</tr>
<tr>
<td><code>this.upload</code></td>
<td><code>function</code></td>
<td>文件上传方法，请参看： 3.4.3 文件上传</td>
</tr>
</tbody>
</table>
<p>更多context文档请参看<a href="http://koajs.com" target="_blank" rel="external">koa官网</a>，或<a href="http://koajs.in/doc/" target="_blank" rel="external">http://koajs.in/doc/</a></p>
<h2 id="3-3-数据库-Database"><a href="#3-3-数据库-Database" class="headerlink" title="3.3 数据库 - Database"></a>3.3 数据库 - Database</h2><p>koa-grace引入基于<a href="mongoosejs.com">mongoose</a>的<a href="https://github.com/xiongwilee/koa-grace-mongo" target="_blank" rel="external">koa-grace-mongo</a> ，可以非常便捷地使用mongoDB。</p>
<h3 id="3-3-1-连接数据库"><a href="#3-3-1-连接数据库" class="headerlink" title="3.3.1 连接数据库"></a>3.3.1 连接数据库</h3><p>在配置文件<code>config/main.js</code>中进行配置：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// mongo配置</span></span><br><span class="line">mongo: &#123;</span><br><span class="line">  options:&#123;</span><br><span class="line">    <span class="comment">// mongoose 配置</span></span><br><span class="line">  &#125;,</span><br><span class="line">  api:&#123;</span><br><span class="line">    <span class="string">'blog'</span>: <span class="string">'mongodb://localhost:27017/blog'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>其中，<code>mongo.options</code>配置mongo连接池等信息，<code>mongo.api</code>配置站点对应的数据库连接路径。</p>
<p>值得注意的是，<strong>配置好数据库之后，一旦koa-grace server启动mongoose就启动连接，直到koa-grace server关闭</strong></p>
<h3 id="3-3-2-mongoose的schema配置"><a href="#3-3-2-mongoose的schema配置" class="headerlink" title="3.3.2 mongoose的schema配置"></a>3.3.2 mongoose的schema配置</h3><p>依旧以案例<code>blog</code>为例，参看<code>app/blog/model/mongo</code>目录：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#9492;&#9472;&#9472; mongo&#10;    &#9500;&#9472;&#9472; Category.js&#10;    &#9500;&#9472;&#9472; Link.js&#10;    &#9500;&#9472;&#9472; Post.js&#10;    &#9492;&#9472;&#9472; User.js</span><br></pre></td></tr></table></figure>
<p>一个js文件即一个数据库表即相关配置，以<code>app/blog/model/mongo/Category.js</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// model名称，即表名</span></span><br><span class="line"><span class="keyword">let</span> model = <span class="string">'Category'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 表结构</span></span><br><span class="line"><span class="keyword">let</span> schema = [&#123;</span><br><span class="line">  id: &#123;type: <span class="built_in">String</span>,unique: <span class="literal">true</span>,required: <span class="literal">true</span>&#125;,</span><br><span class="line">  name: &#123;type: <span class="built_in">String</span>,required: <span class="literal">true</span>&#125;,</span><br><span class="line">  numb: &#123;type: <span class="built_in">Number</span>,<span class="string">'default'</span>:<span class="number">0</span>&#125;</span><br><span class="line">&#125;, &#123;</span><br><span class="line">  autoIndex: <span class="literal">true</span>,</span><br><span class="line">  versionKey: <span class="literal">false</span></span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 静态方法:http://mongoosejs.com/docs/guide.html#statics</span></span><br><span class="line"><span class="keyword">let</span> statics = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法扩展 http://mongoosejs.com/docs/guide.html#methods</span></span><br><span class="line"><span class="keyword">let</span> methods = &#123;</span><br><span class="line">  <span class="comment">/**</span><br><span class="line">   * 获取博客分类列表</span><br><span class="line">   */</span></span><br><span class="line">  list: <span class="function"><span class="keyword">function</span>* (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.model(<span class="string">'Category'</span>).find();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports.model = model;</span><br><span class="line"><span class="built_in">module</span>.exports.schema = schema;</span><br><span class="line"><span class="built_in">module</span>.exports.statics = statics;</span><br><span class="line"><span class="built_in">module</span>.exports.methods = methods;</span><br></pre></td></tr></table></figure>
<p>主要有四个参数：</p>
<ul>
<li><code>model</code> ， 即表名，最好与当前文件同名</li>
<li><code>schema</code> ， 即mongoose schema</li>
<li><code>methods</code> ， 即schema扩展方法，<strong>推荐把数据库元操作都定义在这个对象中</strong></li>
<li><code>statics</code> ， 即静态操作方法</li>
</ul>
<h3 id="3-3-3-在控制器中调用数据库"><a href="#3-3-3-在控制器中调用数据库" class="headerlink" title="3.3.3 在控制器中调用数据库"></a>3.3.3 在控制器中调用数据库</h3><p>在控制器中使用非常简单，主要通过<code>this.mongo</code>,<code>this.mongoMap</code>两个方法。</p>
<h4 id="1）-this-mongo-name"><a href="#1）-this-mongo-name" class="headerlink" title="1） this.mongo(name)"></a>1） <code>this.mongo(name)</code></h4><p>调用mongoose Entity对象进行数据库CURD操作</p>
<p><strong>参数说明:</strong></p>
<p><code>@param [string] name</code> : 在<code>app/blog/model/mongo</code>中配置Schema名，</p>
<p><strong>返回:</strong></p>
<p><code>@return [object]</code> 一个实例化Schema之后的Mongoose Entity对象，可以通过调用该对象的methods进行数据库操作</p>
<p><strong>案例</strong></p>
<p>参考上文中的Category.js的配置，以<code>app/blog/controller/dashboard/post.js</code>为例，如果要在博客列表页中获取博客分类数据：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// http://127.0.0.1/dashboard/post/list</span></span><br><span class="line">exports.list = <span class="function"><span class="keyword">function</span>* (<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">let</span> cates = <span class="keyword">yield</span> <span class="keyword">this</span>.mongo(<span class="string">'Category'</span>).list();</span><br><span class="line">	<span class="keyword">this</span>.body = cates;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2）this-mongoMap-option"><a href="#2）this-mongoMap-option" class="headerlink" title="2）this.mongoMap(option)"></a>2）<code>this.mongoMap(option)</code></h4><p>并行多个数据库操作</p>
<p><strong>参数说明</strong></p>
<p><code>@param [array] option</code> </p>
<p><code>@param [Object] option[].model</code>  mongoose Entity对象，通过this.mongo(model)获取</p>
<p><code>@param [function] option[].fun</code>  mongoose Entity对象方法</p>
<p><code>@param [array] option[].arg</code>  mongoose Entity对象方法参数</p>
<p><strong>返回</strong></p>
<p><code>@return [array]</code> 数据库操作结果，以对应数组的形式返回</p>
<p><strong>案例</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> PostModel = <span class="keyword">this</span>.mongo(<span class="string">'Post'</span>);</span><br><span class="line"><span class="keyword">let</span> mongoResult = <span class="keyword">yield</span> <span class="keyword">this</span>.mongoMap([&#123;</span><br><span class="line">    model: PostModel,</span><br><span class="line">    fun: PostModel.page,</span><br><span class="line">    arg: [pageNum]</span><br><span class="line">  &#125;,&#123;</span><br><span class="line">    model: PostModel,</span><br><span class="line">    fun:PostModel.count,</span><br><span class="line">    arg: [pageNum]</span><br><span class="line">  &#125;]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> posts = mongoResult[<span class="number">0</span>];<span class="comment">// 获取第一个查询PostModel.page的结果</span></span><br><span class="line"><span class="keyword">let</span> page = mongoResult[<span class="number">1</span>]; <span class="comment">// 获取第二个查询PostModel.count的结果，两者并发执行</span></span><br></pre></td></tr></table></figure>
<h2 id="3-4-代理-Proxy"><a href="#3-4-代理-Proxy" class="headerlink" title="3.4 代理 - Proxy"></a>3.4 代理 - Proxy</h2><p>除了在控制器中直接进行数据库操作，Web应用还有可能由其他服务进行后端部署。针对这种场景，koa-grace引入了基于 <a href="https://github.com/request/request" target="_blank" rel="external">Request</a> 的 <a href="https://github.com/xiongwilee/koa-grace-proxy" target="_blank" rel="external">koa-grace-proxy</a>。</p>
<h3 id="3-4-1-数据代理"><a href="#3-4-1-数据代理" class="headerlink" title="3.4.1 数据代理"></a>3.4.1 数据代理</h3><p>在koa-grace的控制器中使用<code>this.proxy</code>方法进行数据代理非常简单：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">exports.list = <span class="function"><span class="keyword">function</span>* (<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">yield</span> <span class="keyword">this</span>.proxy(&#123;</span><br><span class="line">		userInfo:<span class="string">'github:post:user/login/oauth/access_token?client_id=****'</span>,</span><br><span class="line">		otherInfo:<span class="string">'github:other/info?test=test'</span>,</span><br><span class="line">	&#125;);</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="keyword">this</span>.backData);</span><br><span class="line">	<span class="comment">/**</span><br><span class="line">	 *	&#123;</span><br><span class="line">	 *		userInfo : &#123;...&#125;,</span><br><span class="line">	 *		otherInfo : &#123;...&#125;</span><br><span class="line">	 *	&#125;</span><br><span class="line">	 */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>你也可以不传<code>this.backData</code>参数，默认注入到上下文的<code>this.backData</code>对象中：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">exports.list = <span class="function"><span class="keyword">function</span>* (<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">yield</span> <span class="keyword">this</span>.proxy(&#123;</span><br><span class="line">		userInfo:<span class="string">'github:post:user/login/oauth/access_token?client_id=****'</span>,</span><br><span class="line">		otherInfo:<span class="string">'github:other/info?test=test'</span>,</span><br><span class="line">	&#125;);</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="keyword">this</span>.backData);</span><br><span class="line">	<span class="comment">/**</span><br><span class="line">	 *	&#123;</span><br><span class="line">	 *		userInfo : &#123;...&#125;,</span><br><span class="line">	 *		otherInfo : &#123;...&#125;</span><br><span class="line">	 *	&#125;</span><br><span class="line">	 */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>另外，<code>github:post:user/login/oauth/access_token?client_id=****</code>说明如下：</p>
<ul>
<li><code>github</code>： 为在<code>config.main.js</code>的 <code>api</code> 对象中进行配置；</li>
<li><code>post</code> ： 为数据代理请求的请求方法，该参数可以不传，默认为<code>get</code></li>
<li><code>path</code>： 后面请求路径中的query参数会覆盖当前页面的请求参数（this.query），将query一同传到请求的接口</li>
<li>你也可以写完整的路径：<code>{userInfo:&#39;https://api.github.com/user/login?test=test&#39;}</code></li>
</ul>
<h3 id="3-4-2-文件代理"><a href="#3-4-2-文件代理" class="headerlink" title="3.4.2 文件代理"></a>3.4.2 文件代理</h3><p>文件请求代理也很简单，比如如果需要从github代理一个图片请求返回到浏览器中，参考：<a href="http://mlsfe.biz/user/avatar?img=https://avatars.githubusercontent.com/u/1962352?v=3" target="_blank" rel="external">http://mlsfe.biz/user/avatar?img=https://avatars.githubusercontent.com/u/1962352?v=3</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">exports.avatar = <span class="function"><span class="keyword">function</span>* (<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">let</span> imgUrl = query.img;</span><br><span class="line">    <span class="keyword">yield</span> <span class="keyword">this</span>.download(imgUrl);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-4-3-文件上传"><a href="#3-4-3-文件上传" class="headerlink" title="3.4.3 文件上传"></a>3.4.3 文件上传</h3><p>TODO: 文件上传并代理到其他服务或者存储到本地</p>
<h2 id="3-5-模板引擎-Template-engine"><a href="#3-5-模板引擎-Template-engine" class="headerlink" title="3.5 模板引擎- Template engine"></a>3.5 模板引擎- Template engine</h2><p>koa-grace引入<a href="https://github.com/queckezz/koa-views" target="_blank" rel="external">koa-views</a>  ， 进行模板引擎管理。默认的模板引擎为<a href="paularmstrong.github.io/swig/">swig</a>， 您可以在<code>config/main.js</code>中配置<code>template</code>属性您想要模板引擎：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 模板引擎配置</span></span><br><span class="line">template: <span class="string">'swig'</span></span><br></pre></td></tr></table></figure>
<p>目前支持的模板引擎列表在这里：<a href="https://github.com/tj/consolidate.js#supported-template-engines" target="_blank" rel="external">consolidate.js#supported-template-engines</a></p>
<p>在控制器中调用<code>this.render</code>方法渲染模板引擎：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">exports.home = <span class="function"><span class="keyword">function</span>* (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="keyword">this</span>.bindDefault();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">yield</span> <span class="keyword">this</span>.render(<span class="string">'dashboard/site_home'</span>,&#123;</span><br><span class="line">    breads : [<span class="string">'站点管理'</span>,<span class="string">'通用'</span>],</span><br><span class="line">    userInfo: <span class="keyword">this</span>.userInfo,</span><br><span class="line">    siteInfo: <span class="keyword">this</span>.siteInfo</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>模板文件在<code>app/blog/views</code>目录中。</p>
<h2 id="3-6-静态文件服务-Static-server"><a href="#3-6-静态文件服务-Static-server" class="headerlink" title="3.6 静态文件服务 - Static server"></a>3.6 静态文件服务 - Static server</h2><p>koa-grace引入<a href="https://github.com/koajs/mount" target="_blank" rel="external">koa-mount</a>  及  <a href="https://github.com/koajs/static/" target="_blank" rel="external">koa-static</a>，将静态文件代理到<code>/static</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 配置静态文件路由</span></span><br><span class="line">vapp.use(mount(<span class="string">'/static'</span>,</span><br><span class="line">  koastatic(appPath + <span class="string">'/static'</span>)</span><br><span class="line">));</span><br></pre></td></tr></table></figure>
<p>以案例中<code>blog</code>的静态文件为例，静态文件在blog项目下的路径为：<code>app/blog/static/image/bg.jpg</code>，则访问路径为<a href="http://127.0.0.1/static/image/bg.jpg。" target="_blank" rel="external">http://127.0.0.1/static/image/bg.jpg。</a></p>
<h2 id="3-7-启动服务及调试-Process-amp-DEBUG"><a href="#3-7-启动服务及调试-Process-amp-DEBUG" class="headerlink" title="3.7 启动服务及调试 - Process &amp; DEBUG"></a>3.7 启动服务及调试 - Process &amp; DEBUG</h2><h3 id="3-7-1-开发环境"><a href="#3-7-1-开发环境" class="headerlink" title="3.7.1 开发环境"></a>3.7.1 开发环境</h3><p>在开发环境可以使用npm命令完成。</p>
<p>1) 普通启动：    </p>
<pre><code>$ npm run start
</code></pre><p>2) watch启动：</p>
<pre><code>$ npm run dev
# 在80端口启动
$ npm PORT=80 run dev
# DEBUG模式启动，默认为DEBUG=koa-grace*
$ npm DEBUG=* run dev 
</code></pre><h3 id="3-7-2-生产环境"><a href="#3-7-2-生产环境" class="headerlink" title="3.7.2 生产环境"></a>3.7.2 生产环境</h3><p>在生产环境推荐使用 <a href="https://github.com/Unitech/pm2" target="_blank" rel="external">pm2</a> 进行进程管理：</p>
<pre><code>$ npm install pm2 -g
$ pm2 start node ./bin/server.js
</code></pre><p>更多使用方法，请参看 <a href="https://github.com/Unitech/pm2" target="_blank" rel="external">pm2</a>。</p>
<h1 id="4-贡献"><a href="#4-贡献" class="headerlink" title="4. 贡献"></a>4. 贡献</h1><ul>
<li>提ISSUE： <a href="https://github.com/xiongwilee/koa-grace/issues" target="_blank" rel="external">https://github.com/xiongwilee/koa-grace/issues</a> </li>
<li>欢迎提PR</li>
<li>给作者提问&amp;提建议：<a href="xiongwilee@foxmail.com">xiongwilee@foxmail.com</a> </li>
</ul>

      
    </div>
    <footer>
      
        <div class="alignleft">
            <a href="/2016/02/22/koa-grace-document/#more" class="more-link"><i class="fa fa-chevron-right"></i>更多</a>
        </div>
        
        
          <div class="alignright"> 
            <a href="http://wilee.me/2016/02/22/koa-grace-document/#comment" class="comment-link">
              <i class="fa fa-comments"></i><span class="ds-thread-count" data-thread-key="/2016/02/22/koa-grace-document/">&nbsp;
              </span>
            </a>
          </div>
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




  <article class="post">
  <div class="post-content">
    <header>
      
       

  
    <h1 class="title">
      <a href="/2015/07/09/tsinghua_web_frontend_exercises/" target="_blank"><i class="fa fa-file-powerpoint-o"></i> web前端之原生DOM&amp;jQuery-DOM编程习题【清华大学】</a>
    </h1>
  

<div class="collection">
  <time datetime="2015-07-09T14:53:08.000Z"><i class="fa fa-clock-o"></i><span> 2015-07-09 10:53</span></time>
  
  
</div>
<div class="clear"></div>
      
    </header>
    
      <div class="gallery">
  <div class="photoset">
    
      <img src="">
    
  </div>
  <div class="control">
    <div class="prev"><i class="fa fa-chevron-left"></i></div>
    <div class="next"><i class="fa fa-chevron-right"></i></div>
  </div>
</div>
    
    <div class="entry">
      
        <p>清华大学web前端之原生DOM&jQuery-DOM编程习题</p>
      
    </div>
    <footer>
      
        <div class="alignleft">
            <a href="/2015/07/09/tsinghua_web_frontend_exercises/#more" class="more-link"><i class="fa fa-chevron-right"></i>更多</a>
        </div>
        
        
          <div class="alignright"> 
            <a href="http://wilee.me/2015/07/09/tsinghua_web_frontend_exercises/#comment" class="comment-link">
              <i class="fa fa-comments"></i><span class="ds-thread-count" data-thread-key="/2015/07/09/tsinghua_web_frontend_exercises/">&nbsp;
              </span>
            </a>
          </div>
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





<nav id="pagination">
  
  
    <a href="/page/2/" class="alignright next">next<i class="fa fa-long-arrow-right"></i></a>
  
  <div class="clearfix"></div>
</nav>

<script src="/js/jquery.anystretch.min.js" type="text/javascript"></script>
<script src="/js/cover.js" type="text/javascript"></script>
<script src="/js/skrollr.min.js" type="text/javascript"></script>
<script type="text/javascript">
	if(window.ontouchstart === undefined){
		//视差滚动仅仅用在PC端
		setTimeout(function(){
			$('#profile').attr({"data-0":"top:0px;opacity:1;","data-1000":"top:500px;opacity:.2;"});//logo
			$('#socials').attr({"data-0":"margin-top:80px;","data-1000":"margin-top:-30px;"});//社交logo
			$('.anystretch img').attr({'data-0':'margin-top:0px','data-1000':'margin-top:150px','data-1001':'margin-top:0px'});//大bnner
			var Skrollr = skrollr.init();//视差滚动
		},300)
	}
</script>


    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div>
  
  &copy; 2016 xiongwilee
  
</div>
Powered by <a href="http://zespia.tw/hexo/" title="Hexo" target="_blank" rel="external">Hexo</a> and <a href="http://pages.github.com/" title="GitHub Pages" target="_blank" rel="external">GitHub Pages</a>

<div class="clearfix"></div></footer>
  
<script src="/js/jquery.imagesloaded.min.js" type="text/javascript"></script>
<script src="/js/gallery.js" type="text/javascript"></script>
<script src="/bootstrap/bootstrap.min.js" type="text/javascript"></script>





  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>
  <script type="text/javascript">
  (function($){
    $('.fancybox').fancybox({
      'titlePosition': 'inside'
    });
  })(jQuery);
  </script>



    <script type="text/javascript">
      var duoshuoQuery = {short_name:"xiongwilee"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.src = 'http://static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0] 
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>



</body>
</html>